# vi: ft=just

set shell := ["bash", "-eu", "-o", "pipefail", "-c"]

# 命名约定
#   <主分类>-<功能领域>-<name>[-<os>]
#   - 主分类(primary): core/system/cli/gui/extra
#   - 功能领域(domain): develop/media/productivity/db/vm/util/other
#   - 可选 OS 后缀：darwin/linux/termux（缺省表示通用）
# 新增 recipe 必须遵守上述命名，方可被 `list`/`install` 等命令识别。
primary_categories := "core system cli gui extra"
domain_categories := "develop media productivity db vm util other"

default:
    @just --list

help:
    @printf '%s\n' \
    '命令概览:' \
    '  just list [main=core] [domain=develop] [os=darwin] [name=git] [raw=1]' \
    '      - 根据命名规范(<主类>-<领域>-<名称>[-<平台>])筛选可用 recipe。' \
    '  just install <name> [name...]' \
    '      - 根据名称匹配当前平台的 recipe，直接执行安装。' \
    '  just install-menu [main=core] [domain=develop] [os=linux]' \
    '      - 交互式多选安装，支持 fzf (若已安装)。' \
    '  just platform-info' \
    '      - 显示平台判定结果，便于调试。' \
    '' \
    '命名规范: <主分类>-<领域>-<name>[-<os>]，例如 core-develop-git-darwin。'

platform-info:
    @just/platform.sh

list *filters:
    @JUSTFILE_PATH="{{justfile()}}" just/list.sh {{filters}}

install *packages:
    @JUSTFILE_PATH="{{justfile()}}" TARGET_PLATFORM="$(just/platform.sh)" just/install.sh {{packages}}

install-menu *filters:
    @JUSTFILE_PATH="{{justfile()}}" TARGET_PLATFORM="$(just/platform.sh)" just/install_menu.sh {{filters}}

# --- core: base toolchain & CLI essentials ---

# 基础构建依赖
core-develop-autoconf:
    brew install autoconf

core-develop-automake:
    brew install automake

core-util-p7zip:
    brew install p7zip

core-util-tree:
    brew install tree

core-productivity-zoxide:
    brew install zoxide

### fonts
#   nerd fonts(https://github.com/ryanoasis/nerd-fonts/blob/master/readme_cn.md)
#       config terminal: menu->setting...->text->font->change font
core-media-jetbrains-mono-nerd-font:
    brew install font-jetbrains-mono-nerd-font

# asdf 安装流程
core-develop-asdf:
    brew install asdf

core-develop-asdf-tool-versions:
    ln -snf "./asdf/tool-versions" "${HOME}/.tool-versions"

core-develop-asdf-install:
    asdf install

# 通用 CLI 套件
core-cli-bat:
    # bat -> cat: Clone of cat(1) with syntax highlighting and Git integration.
    brew install bat

core-cli-btop:
    # btop -> top: Resource monitor. Enhanced top command.
    brew install btop

core-cli-fd:
    # fd -> find: Simple, fast and user-friendly alternative to find.
    brew install fd

core-cli-fzf:
    # fzf: Command-line fuzzy finder.
    brew install fzf

core-cli-ripgrep:
    # ripgrep -> find: Search tool like grep.
    brew install ripgrep

core-cli-tealdeer:
    # tealdeer -> man: short TLDR client.
    brew install tealdeer

# 网络/同步工具
# core-util-adwaita-icon-theme:
# 	# 仅用于 macOS 上的 GTK 应用（例如 grsync）补齐主题；等待 grsync 迁移时再一起处理。

core-cli-grsync:
	brew install grsync

core-cli-rsync:
    brew install rsync

core-cli-wget:
    brew install wget

core-media-yt-dlp:
	brew install yt-dlp

# --- system: desktop integration & utilities ---

### hammerspoon & tray helpers
system-util-hammerspoon-darwin:
	brew install --cask --no-quarantine hammerspoon
	defaults write org.hammerspoon.Hammerspoon MJConfigFile "${XDG_CONFIG_HOME:-$HOME/.config}"/hammerspoon/init.lua

system-util-caffeine-darwin:
	# tray: easily block OS from sleeping
	brew install --cask caffeine

system-productivity-easydict-darwin:
	# tray: easydict translator
	brew install --cask easydict

system-productivity-dropshelf-darwin:
	# tray: drag & drop shelf
	brew install --cask dropshelf

system-productivity-neardrop-darwin:
	# tray: nearby Android sharing
	brew install --cask grishka/grishka/neardrop

system-util-stats-darwin:
	# tray: system monitor utility
	brew install --cask stats

### system applications
system-media-quickrecorder-darwin:
	brew install lihaoyun6/tap/quickrecorder

system-productivity-raycast-darwin:
	# spotlight replacement
	brew install --cask raycast

system-util-mediainfo-darwin:
	# Finder contextual media info
	brew install --cask mediainfo

system-productivity-openvanilla-darwin:
	brew install openvanilla
	mkdir -p "${HOME}/Library/Application Support/OpenVanilla/UserData/TableBased/erbi.cin"
	ln -snf "./backups/erbi/OpenVanilla/erbi.cin" "${HOME}/Library/Application Support/OpenVanilla/UserData/TableBased/erbi.cin"

system-media-aerial-darwin:
	brew install --cask aerial

### Quick Look enhancements
system-media-quicklook-suite-darwin:
	brew install --cask apparency suspicious-package
	brew install --cask --no-quarantine qladdict qlcolorcode qlprettypatch qlvideo quicklook-json syntax-highlight
	xattr -cr ~/Library/QuickLook/QLAddict.qlgenerator
	xattr -cr ~/Library/QuickLook/qlprettypatch.qlgenerator
	qlmanage -r cache
	open /Applications/QuickLook\ Video.app

### system tweaks
system-util-karabiner-elements-darwin:
	brew install --cask karabiner-elements

system-productivity-keepassxc-darwin:
	brew install --cask keepassxc

system-util-macvim-darwin:
	brew install --cask macvim

system-util-kitty-darwin:
	brew install --cask kitty

system-other-scrcpy:
	brew install scrcpy
