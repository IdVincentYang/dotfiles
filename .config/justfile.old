# vi: ft=sh
# [doc](https://just.systems/man/zh/)
# [grammar](https://github.com/casey/just/blob/master/GRAMMAR.md)
# [cheetsheet](https://cheatography.com/linux-china/cheat-sheets/justfile/)

kPWD := justfile_directory()

default:
    @just --justfile '{{justfile()}}' --list

var:
    @just --justfile '{{justfile()}}' --evaluate

app-media-install-iina:
    brew install --cask iina
    mkdir -p "${HOME}/Library/Application Support/com.colliderli.iina/input_conf/IINA_MY.conf"
    ln -s "${HOME}/.config/backups/iina/input_conf/IINA_MY.conf" "Library/Application Support/com.colliderli.iina/input_conf/IINA_MY.conf"

cmd-aichat:
    #!/usr/bin/env bash
    cd ${HOME}
    set -euxo pipefail
    brew install aichat
    yadm submodule update --init
    # _AICHAT_FUNCTIONS_DIR="$(aichat --info | sed -n 's/^functions_dir *//p')"
    # _AICHAT_FUNCTIONS_DIR=".config/aichat/functions"
    # yadm submodule add -- https://github.com/sigoden/llm-functions.git "${_AICHAT_FUNCTIONS_DIR}"
    # yadm commit -m "[update] setup aichat functions repo to ${_AICHAT_FUNCTIONS_DIR}"

dev-tool-git:
    ### enhance git first
    #   cmd: Archive a repository with all its submodules.
    brew install git-archive-all onefetch
    #   app: git GUI
    # brew install --cask smartgit
    brew install --cask fork

dev-tool-rust:
    brew install rustup
    rustup default stable

dev-app:
    ### design tools
    #brew install --cask drawio freeplane

    ### coding tools
    #   cmd: code searching tool, usage: ag
    #       doc: https://github.com/ggreer/the_silver_searcher/wiki/Advanced-Usage
    # brew install the_silver_searcher
    #   app: for file compare
    #       reset tral version: rm "/Users/$(whoami)/Library/Application Support/Beyond Compare/registry.dat"
    brew install --cask beyond-compare
    #   cmd: count source lines(replace cloc)
    brew install tokei

    ### C++ dev tools
    brew install cmake

    ### java dev tools
    # install java via android studio

    ### java/android crack tools
    # brew install apktool dex2jar jd-gui

    ### javascript dev tools
    brew install --cask visual-studio-code

dev-net:
    brew install iperf3 iproute2mac
    brew install --cask sloth
    brew install --cask charles wireshark
    brew install --cask postman

extra-app-applite:
    #   app: homebrew GUI
    # brew install cakebrew
    #   app: homebrew GUI for cask apps
    brew install --cask --no-quarantine applite

net-app:
    brew install --cask cyberduck

sys-app-install-hammerspoon:
    brew install --cask --no-quarantine hammerspoon
    defaults write org.hammerspoon.Hammerspoon MJConfigFile "${XDG_CONFIG_HOME:-$HOME/.config}"/hammerspoon/init.lua

sys-app-quickrecorder:
    brew install lihaoyun6/tap/quickrecorder

sys-app-raycast:
    ### spotlight replacement
    brew install --cask raycast

sys-finder-extensions:
    ### Finder extensions:
    #   add button in toolbar to open termial
    # brew install go2shell
    #   content menu: show media info
    brew install --cask mediainfo


sys-ime-openvanilla:
    brew install openvanilla
    mkdir -p "${HOME}/Library/Application Support/OpenVanilla/UserData/TableBased/erbi.cin"
    ln -s "./backups/erbi/OpenVanilla/erbi.cin" "${HOME}/Library/Application Support/OpenVanilla/UserData/TableBased/erbi.cin"

sys-screensaver-aerial:
    # brew install aerial

sys-tray-extensions:
    ### service with tray icons:
    #   tray: easily block os to sleep
    brew install --cask caffeine
    #   tray: clipboard manager all replaced by raycast
    # brew install --cask --no-quarantine copyq
    # brew install --cask maccy
    #   tray: auto-tools program with lua. for key-shortcuts configure, config under ~/.local/hammerspoon/
    brew install --cask hammerspoon
    #   tray: enhance date tray icon's feature
    # brew install --cask itsycal
    #   [not maintainment] tray: dozer, add hide icon feature
    # brew install --cask dozer
    #   tray: easydict, translate util
    brew install --cask easydict
    #   tray: dropshelf, drag drop anything
    brew install --cask dropshelf
    #   tray: nearby, share items with nearby android
    #       https://github.com/grishka/NearDrop
    brew install --cask grishka/grishka/neardrop
    #   tray: system monitor util
    brew install --cask stats

sys-ql:
    # mac app info viewer, include ql plugin
    brew install --cask apparency suspicious-package

    # https://github.com/sindresorhus/quick-look-plugins
    # If you run into issues with macOS not letting you run the plugin because it's not signed by a verified developer you can follow these steps:
    # run xattr -cr ~/Library/QuickLook/<QLPlugName>.qlgenerator (sudo if needed)
    # run qlmanage -r
    # run qlmanage -r cache
    # Restart Finder by...
    # Restarting your computer
    # or holding down the option key and right click on Finder’s dock icon, then select “Relaunch” from the menu
    #
    # Plugins:
    #   - provisionql:      ipa & provision
    #   - qladdict:         srt file
    #   - qldds:
    #   - qlmarkdown:       markdown
    #   - qlgradle:
    #   - qlprettypatch:
    #   - qlvideo:          unsupported video format 
    #   - quicklook-json:   json
    #   - quicklook-pat:    view Adobe Photoshop pattern files
    #   - quicklookapk:
    #   - quicklookase:     quicklook for ASE files (Adobe Swatch Exchange)
    #   - receiptquicklook: inspect App Store receipts
    #   - syntax-highlight: code preview
    #
    # no used:
    #   - quicklook-csv:    osx supported
    #   - webpquicklook:    osx supported
    #   - qlstephen:        osx supported

    brew install --cask --no-quarantine qladdict qlcolorcode qlprettypatch qlvideo quicklook-json syntax-highlight

    xattr -cr ~/Library/QuickLook/QLAddict.qlgenerator
    xattr -cr ~/Library/QuickLook/qlprettypatch.qlgenerator
    qlmanage -r cache
    open /Applications/QuickLook\ Video.app

sys-tweak:
    ### apps for system enhance:
    #   app: tweak keyboard functions. eg: map right CMD to CMD+OPT+CTRL+SHIFT
    brew install --cask karabiner-elements
    #   app: private passwords database
    brew install --cask keepassxc
    #   app: key-shortcuts macro maker, replaced by hammerspoon
    # brew install --cask keyboard-maestro
    #   app: vim doc chinese version: https://sourceforge.net/projects/vimcdoc/
    brew install --cask macvim
    #   app: terminal
    # brew install --cask warp
    brew install --cask kitty

app-common:
    brew install --cask aria2gui gimp google-chrome icefloor

    ### devices apps
    #   cmd: connect android device via usb for device control
    brew install scrcpy
    #   app: (most case scrcpy instead)connect android device via wifi and usb for device control
    # brew install soduto
    #   tray: disable intel cpu's boost feature for save power
    #       usage: sudo /Applications/Turbo\ Boost\ Switcher.app/Contents/MacOS/Turbo\ Boost\ Switcher
    # (unsupport apple silicon)brew install turbo-boost-switcher

    ### graphic apps
    # app: vector graphics editor
    brew install --cask inkscape

    ### media apps
    brew install --cask losslesscut invisor-lite
    brew install --cask iina
    # brew install --cask 5kplayer
    # brew install --cask macx-youtube-downloader

    ### game tools
    # (unsupport apple silicon) brew install --cask openemu
    brew install --cask xemu
    # (have not used)brew install --cask aethersx2
    # (have not used, Nintendo 3DS emulator) brew install --cask citra

    ### VM ware
    #   app: vm ware, replaced by VMWare
    # brew install --cask rdm virtualbox virtualbox-extension-pac
    # brew install wine-stable
    brew install --cask vmware-fusion

app-db:
    # sqlite client app
    brew install --cask --no-quarantine db-browser-for-sqlite

    # sql server and client app
    # - default db named `postgresql` created under     /opt/homebrew/var/postgresql@16
    brew install postgresql@16
    brew install --cask --no-quarantine pgadmin4
    brew services start postgresql@16

local-setup:
    #!/usr/bin/env bash
    set -euxo pipefail
    _LOCAL="${HOME}/.local"
    if [ ! -e "$_LOCAL" ]; then
        mkdir "$_LOCAL}"
    fi
    if [ -d "$_LOCAL" ]; then
        cd "$_LOCAL"
        if [ ! -e ".git" ]; then
            git init
        fi
        _GITIGNORE=.gitignore
        if [ ! -e "$_GITIGNORE" ]; then
            echo "/*" > .gitignore
            git add -f "$_GITIGNORE"
            git commit -m "[update] $_GITIGNORE"
        fi
        _GITMODULES=.gitmodules
        if [ ! -e "$_GITMODULES" ]; then
            touch "$_GITMODULES"
            git add -f "$_GITMODULES"
            git commit -m "[update] $_GITMODULES"
        fi
        _JUSTFILE=justfile
        if [[ ! -e "$_JUSTFILE" ]]; then
            ln -s "{{kPWD}}/justfile.local" "justfile"
        fi
    else
        echo "Invalid directory: $_LOCAL"
    fi

serv-pm2-setup:
    pm2 start "${HOME}/.local/bin/autoadb" --name autoadb_scrcpy -- "${HOME}/.config/backups/raycast/scirpt-commands/pixel4scrcpy.sh" "{}"
    pm2 start "/opt/homebrew/bin/openresty" --name serv_openresty_sites -- -c "${HOME}/Sites/nginx.conf" -e "${HOME}/Sites/_nginx/error.log" -g "daemon off;" -p "${HOME}/Sites/_nginx"
